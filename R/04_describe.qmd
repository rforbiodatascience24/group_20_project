---
title: "Analysing metadata"
author: Antoine Andréoletti (s242830), Olivier Gaufrès (s243252), Amy Surry (s201902), Lea Skytthe (s203531), Trine Søgaard (s204655)
format:
  html:
    embed-resources: true
editor: visual
---

The objective of this file is to analyse the patients we have.

## Importing libraries

```{r}
#| label: load-libraries
#| message: False
#| warning: False

rm(list=ls())

library("tidyverse")
library("table1")
```

## Importing the data

```{r}
#| label: load-data

metadata <- read_csv("../data/03_metadata_aug.csv")
```

```{r}
#| label: inspect-data

metadata |> sample_n(5)
```

Making a table of our data

```{r}
#| label: table1

metadata |> 
  mutate(sex = factor(sex),
         disease = factor(disease)) |> 
  table1(x = formula(~ sex + age | disease),
         data = _)
```

## Analysing age, gender, and disease distributions

Lets start with age and sex

```{r}
#| label: age-and-sex-distribution

metadata |> 
  mutate(age_group = cut(
    x = age,
    breaks = seq(from = 0,
                 to = 100,
                 by = 10))) |> 
  ggplot(mapping = aes(x = age_group, 
                       fill = sex)) +
  geom_histogram(stat = "count", 
                 position = position_dodge(preserve = "single"),
                 color = "black")
```

Now lets look at disease distribution in our dataset

```{r}
#| label: disease-distribution

metadata |> 
  ggplot(mapping = aes(x = disease, fill = sex)) +
  geom_histogram(stat = "count",
                 position = position_dodge(preserve = "single"),
                 color = "black") 
```

Do the diseases depend on age?

```{r}
#| label: average-age-for-the-diseases

metadata |> 
  ggplot(mapping = aes(x = disease, y = age, fill = sex)) +
    geom_boxplot()
```

Lets make a statistical analysis to see if there is any significant difference in the average age of people with cirrhosis disease as it looks like in the above plot.

```{r}
#| label: significance-between-gender

male_cirrhosis <- metadata |> 
  filter(sex == "male", 
         disease == "cirrhosis of liver") |> 
  pull(age)

female_cirrhosis <- metadata |> 
  filter(sex == "female", 
         disease == "cirrhosis of liver") |> 
  pull(age)

p_value <- t.test(male_cirrhosis, female_cirrhosis)$p.value
print(paste("The p-value is:", round(p_value,3)))
```

The p-value is above 0.05 so we can say that there is no significant difference between the two groups.

## Fasting vs postprandial

```{r}
#| label: fasting-and-postprandial-distribution

metadata |> 
  mutate(age_group = cut(
    x = age,
    breaks = seq(from = 0,
                 to = 100,
                 by = 10))) |> 
  ggplot(mapping = aes(x = age_group, 
                       fill = clinical_information)) +
  geom_histogram(stat = "count", 
                 position = position_dodge(preserve = "single"),
                 color = "black")
```
